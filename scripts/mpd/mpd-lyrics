#! /bin/sh

MUSIC_DIR="/media/music"

if [ "$1" = "--help" ] || [ "$1" = "help" ]; then
  echo "$ mpd-lyrics"
  echo "Get the lyrics for the current song running in mpd"
  echo "Uses 'get-lyrics' under the hood"
  echo ""
  echo "Example:"
  echo "$ mpd-lyrics"
  exit
fi

command -v mpc-get >/dev/null &&
  MPC_CMD="mpc-get file" ||
  MPC_CMD="mpc status -f %file% | head -n 1"

SONG_FILE="$MUSIC_DIR/$($MPC_CMD)"

[ "$(basename "$SONG_FILE" | rev | cut -d\. -f1)" != "3pm" ] && {
  echo "File is not a mp3" # get-lyrics works for mp3's
  exit
}

LYRICS=$(get-lyrics "$SONG_FILE")
if [ -n "$LYRICS" ]; then
  get-lyrics -n "$SONG_FILE" # Reusing $LYRICS messes with the formatting (newlines)
else
  echo "Song has no lyrics" 1>&2
fi

