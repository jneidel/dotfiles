# lf file manager config
## docs: lf -doc L
## example: https://raw.githubusercontent.com/BrodieRobertson/dotfiles/master/config/lf/lfrc

# from https://github.com/thimc/lfimg
set previewer ~/.config/lf/preview
set cleaner ~/.config/lf/cleaner
# set previewer ~/scripts/lf-preview
set nodirfirst
set relativenumber
set ratios 5:4
set hiddenfiles ".*:*.aux:*.log:*.synctex.gz:*.bcf:*.run.xml:*.bbl:*.blg:*.toc:*.nav:*.out:*.snm:package-lock.json:node_modules:prog3" # ignore
set cursorpreviewfmt "\033[48;5;240m"

# for working with $fs/$fx
set shell zsh
set shellopts '-eu:--shwordsplit'
set ifs "\n"
set filesep "\n"

## custom functions
cmd open ${{
  ~/scripts/mime/mime -e lf open "$f"
}}
cmd openAndSwitch ${{
  ~/scripts/mime/mime -e lf open "$f"
  tmux next-window
}}
cmd diropen ${{
  ~/.config/lf/scripts/handle-dir "$f"
}}
cmd diropenShuffle ${{
  ~/.config/lf/scripts/handle-dir "$f" -s
}}

cmd remove ${{
  rm -rf $fx
}}

cmd edit ${{
  ~/scripts/mime/mime -e lf edit "$f"
}}

cmd massmove ${{
  qmv -f do -d $fx

  # if spaces in name, qmv spawns annoying empty dirs
  findex . -type d 'rmdir "$1"' >/dev/null 2>/dev/null &
}}

cmd mkdir %printf "Directory Name: "; read ans; mkdir "$ans"
cmd touch %printf "File Name: "; read ans; touch "$ans"
cmd touchTex ${{
  printf "Tex Name: "
  read ans
  vtex "$ans"
}}
cmd move-to-inbox %printf "Moved '${f##*/}' to inbox"; mv "$f" ~/org/0_inbox/

cmd broot_jump ${{
  f=$(mktemp)
  res="$(broot -f --outcmd $f && cat $f | sed 's/cd //')"
  rm -f "$f"
  /bin/lf -remote "send $id cd '$res'"
}}

cmd gimp ${{
  gimp "$f" >/dev/null 2>&1 &
}}

cmd rm_pi ${{
  # remove a file from the local music lib and the pi's
  REMOTE_FILE=""
  if realpath $f | grep 'unheard'; then
    FILE="$(realpath $f | grep -Po '/unheard/\K.*$')"
    REMOTE_FILE="\$HOME/usb/unheard/$FILE"
  else
    FILE="$(realpath $f | grep -Po '/music/\K.*$')"
    REMOTE_FILE="\$HOME/usb/music/$FILE"
  fi

  echo "Removing file: '$FILE' at\n  '$REMOTE_FILE'\nContinue (y/N): "
  read ans
  if [ "$ans" != "y" ]; then
    exit 0
  fi

  ssh pi "rm -r \"$REMOTE_FILE\""
  rm -r "$f"
}}

cmd paste_and_forget ${{
  lf -remote 'send paste'
  lf -remote 'send clear'
}}

## create files
cmd create-index ${{
  touch index.norg
  vim index.norg
}}
cmd gen-note ${{
  ~/scripts/gen-note
}}

## bindings
### remove defaults
map m
map d
map e
map r
map p
map c
map N # jump to prev result

### own bindings
map e edit
map rm remove $f
map rp rm_pi
map x cut
map p paste_and_forget
map <esc> clear
map m massmove
map d mkdir
map D diropen
map Y diropenShuffle
map L openAndSwitch
# map f broot_jump
map . set hidden!
map R reload
map I gimp # [I]mage
map b move-to-inbox # in[B]ox

### create files
map t touch
map T touchTex
map NN gen-note
map ci create-index

### jump - cd to dirs

map go  cd ~/org
map gi  cd ~/org/0_inbox
map gd  cd ~/org/1_design
map gp  cd ~/org/2_project
map ga  cd ~/org/3_areas
map gr  cd ~/org/4_resources
map gmm cd ~/org/4_resources/1_media
map gb  cd ~/org/4_resources/1_media/books
map gmo cd ~/org/4_resources/1_media/movies
map gM  cd ~/org/4_resources/1_media/music

map gD cd ~/Downloads
# map gu cd ~/projects/uni
# map gG cd ~/projects/geldhochschule
# map gt cd ~/projects/geldhochschule/1_Trades
map gc cd ~/code
# map gc cd ~/ct
# map gC cd ~/ct/podcasts
# map gP cd ~/ct/pictures
map gB cd ~/code/notes/books
map gn cd ~/code/notes
map gR cd ~/code/notes/research
# map gs cd ~/projects/spanish
# map gl cd ~/projects/latin
# map ge cd ~/projects/morning_routine/meditation

map o jump-prev
map i jump-next
